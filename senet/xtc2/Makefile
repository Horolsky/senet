#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

# Points to the root of Google Test, relative to where this file is.
# Remember to tweak this if you move this file.
ifndef GTEST_DIR
GTEST_DIR = ../../../googletest/googletest
endif

CPPFLAGS += -isystem $(GTEST_DIR)/include
CXXFLAGS += -g -std=gnu++14 -Wall -Wextra -pedantic -pthread -fsanitize=address,undefined

SOURCE_DIR = src
# LIB_DIR = lib
TEST_DIR = test
TEST_BUILD = test/build
KERNEL_NAME = $(shell uname -s)
MACHINE_NAME = $(shell uname -m)

.PHONY: all clean build test

# House-keeping build targets.
all : test

format: .clang-format
	clang-format -i -style=file src/* test/*

CPPCHECK = cppcheck
CHECKFLAGS = -q --error-exitcode=1
CHECKLOG = cppcheck.out.xml

$(CHECKLOG): 
	$(CPPCHECK) $(CHECKFLAGS) src/* test/* --xml >$@

check:
	cppcheck --enable=all --verbose src/* test/* --xml  2>$(CHECKLOG)

tidy: .clang-tidy
	clang-tidy --extra-arg-before=-xc++ --format-style=file src/* test/* 

clean :
	make -C $(TEST_BUILD) clean


test: $(TEST_BUILD)
	make -C $(TEST_BUILD)